name: Create Jira issue
on: 
  issues: 
    types: [opened]

jobs: 
  create-issue: 
    name: Create Jira issue 
    runs-on: ubuntu-latest 
    steps: 
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Login
        uses: atlassian/gajira-login@v3 
        env: 
          JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
          JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
          JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}

      - name: Create Issue 
        uses: atlassian/gajira-create@v3
        with:
          project: '${{ secrets.JIRA_PROJECT_KEY }}'
          issuetype: Task
          summary: '${{ github.event.issue.title }}'
          description: '${{ github.event.issue.html_url }}'

      - name: Get branch name from issue body
        id: get_branch_name
        run: |
          echo "BRANCH_NAME=$(echo '${{ github.event.issue.body }}' | grep -oP '(?<=ðŸŒ³ ë¸Œëžœì¹˜ëª… \(Branch\): ).*')" >> $GITHUB_ENV

      - name: Create new branch
        run: |
          git checkout -b "main-${{ env.BRANCH_NAME }}"
          git push origin "main-${{ env.BRANCH_NAME }}"
