name: Create Jira issue # 1
on: # 2
  issues: 
    types: [opened]

jobs: # 3
  create-issue: # 4
    name: Create Jira issue # 5
    runs-on: ubuntu-latest # 6
    steps: # 7
    - name: Login
      uses: atlassian/gajira-login@v3 # 8
      env: # 9
        JIRA_BASE_URL: ${{ secrets.JIRA_BASE_URL }}
        JIRA_API_TOKEN: ${{ secrets.JIRA_API_TOKEN }}
        JIRA_USER_EMAIL: ${{ secrets.JIRA_USER_EMAIL }}

    - name: Create Issue 
      uses: atlassian/gajira-create@v3
      with:
        project: '${{ secrets.JIRA_PROJECT_KEY }}'
        issuetype: Task
        summary: '${{ github.event.issue.title }}'
        description: '${{ github.event.issue.html_url }}'

    - name: Get branch name from issue body
      id: get_branch_name
      run: |
        echo "BRANCH_NAME=$(echo '${{ github.event.issue.body }}' | grep -oP '(?<=ðŸŒ³ ë¸Œëžœì¹˜ëª… \(Branch\): ).*')" >> $GITHUB_ENV

    - name: Create new branch
      run: |
        git checkout -b "main-${{ env.BRANCH_NAME }}"
        git push origin "main-${{ env.BRANCH_NAME }}"
